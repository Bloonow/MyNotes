[toc]

“三分技术，七分管理，十二分基础数据”是数据库设计的特点之一。数据库设计应该和应用系统设计相结合，整个设计过程中要把数据库结构设计和对数据的处理设计密切结合起来，这是数据库设计的特点之二。在早期的结构化设计（Structure Design）中只可能就尽可能推迟数据结构设计的决策，这种方法对于数据库应用系统的设计显然是不妥的。

我们强调在数据库设计中要把结构特性和行为特性结合起来。

# 一、数据库设计的基本步骤

按照结构化系统设计的方法，考虑数据库及其应用系统开发全过程，将数据库设计分为以下6个阶段。

![](数据库设计与应用开发.assets/数据库设计步骤.jpg)

需求分析和概念结构设计可以独立于任何数据库管理系统进行，逻辑结构设计和物理结构设计与选用的数据库管理系统密切相关。

参加数据库设计的人员，包括系统分析人员、数据库设计人员、应用开发人员、数据库管理员和用户代表，系统分析和数据库设计人员是核心，将自始至终参与。如果所设计的数据库应用系统比较复杂，还应该考虑是否需要使用数据库设计工具以及选用何种工具，以提高数据库设计质量并减少设计工作量。

1. 需求分析阶段进行数据库设计首先必须准确了解与分析用户需求（包括数据与处理）。
2. 概念结构设计通过对用户需求进行综合、归纳与抽象，形成一个独立于具体数据库管理系统的概念模型。
3. 逻辑结构设计是将概念结构转换为某个数据库管理系统所支持的数据模型，并对其进行优化。
4. 物理结构设计是为逻辑数据模型选取一个最适合应用环境的物理结构（包括存储结构和存取方法）。
5. 在数据库实施阶段，设计人员运用DBMS提供的数据库语言及其宿主语言，根据逻辑设计和物理设计的结果建立数据库，编写与调试应用程序，组织数据入库，并进行试运行。
6. 在数据库运行和维护阶段，数据库应用系统经过试运行后即可投入正式运行，在数据库系统运行过程中必须不断地对其进行评估、调整与修改。

设计一个完善的数据库应用系统是不可能一蹴而就的，它往往是上述6个阶段的不断反复迭代。

再次强调，这个设计步骤既是数据库设计的过程，也包括了数据库应用系统的设计过程。在设计过程中把数据库的设计和对数据库中数据处理的设计紧密结合起来，将这两个方面的需求分析、抽象、设计、实现在各个阶段同时进行，相互参照，相互补充，以完善两方面的设计。

数据库设计的不同阶段形成数据库的各级模式，如图。

![](数据库设计与应用开发.assets/数据库设计的各级模式.jpg)

# 二、需求分析

## （一）需求分析的任务

是通过详细调查现实世界要处理的对象（组织、部门、企业等），充分了解原系统（手工系统或计算机系统）的工作概况，明确用户的各种需求，然后在此基础上确定新系统的功能。新系统必须充分考虑今后可能的扩充和改变，不能仅仅按当前应用需求来设计数据库。

调查的重点是“数据”和“处理”，获得用户对数据库的如下要求：

- 信息要求。指用户需要从数据库中获得信息的内容与性质。由信息要求可以导出数据要求，即在数据库中需要存储哪些数据。
- 处理要求。指用户要完成的数据处理功能，对处理性能的要求。
- 安全性与完整性要求。

## （二）需求分析的方法

调查用户需求的具体步骤是：

1. 调查组织机构情况。包括了解该组织的部门组成情况、各部门的职责等，为分析信息流程做准备。
2. 调查各部门的业务活动情况。包括了解各部门输入和使用什么数据，如何加工处理这些数据，输出什么信息，输出到什么部门，输出结果的格式是什么等，这是调查的重点。
3. 在熟悉业务活动的基础上，协助用户明确对新系统的各种要求，包括信息要求、处理要求、安全性与完整性要求，这是调查的又一个重点。
4. 确定新系统的边界。对前面调查的结果进行初步分析，确定哪些功能由计算机完成或将来准备让计算机完成，哪些活动由人工完成。由计算机完成的功能就是新系统应该实现的功能。

调查了解用户需求以后，还需要进一步分析和表达用户的需求。对用户需求进行分析与表达后，需求分析报告必须提交给用户，征得用户的认可。

## （三）数据字典

数据字典是在需求分析阶段建立，在数据库设计过程中不断修改、充实、完善的。它是关于数据库中数据的描述，即元数据。通常包括数据项、数据结构、数据流、数据存储、处理过程几部分。其中数据项是数据的最小组成单位，若干个数据项可以组成一个数据结构。数据字典通过对数据项和数据结构的定义来描述数据流、数据存储的逻辑内容。

1. **数据项**

数据项是不可再分的数据单位。通常，数据项描述={数据项名，数据项含义说明，别名，数据类型，长度，取值范围，取值含义，与其他数据项的逻辑关系，数据项之间的联系}

其中，“取值范围”、“与其他数据项的逻辑关系”（如该数据项等于其他几个数据项的和、该数据项值等于另一数据项的值等）定义了数据的完整性约束条件，是设计数据检验功能的依据。

可以用关系规范化理论为指导，用数据依赖的概念分析和表示数据项之间的联系。即按实际语义写出每个数据项之间的数据依赖，它们是数据库逻辑设计阶段数据模型优化的依据。

2. **数据结构**

数据结构反映了数据之间的组合关系，一个数据结构可以由若干个数据项、或数据结构、或数据项和数据结构混合组成。通常，数据结构描述={数据结构名，含义说明，组成:{数据项或数据结构}}

3. **数据流**

数据流是数据结构在系统内传输的路径。通常,数据流描述={数据流名，说明，数据流来源，数据流去向，组成:{数据结构}，平均流量，高峰期流量}

其中，“数据流来源”是说明该数据流来自哪个过程；“数据流去向”是说明该数据流将到哪个过程去；“平均流量”是指在单位时间（每天、每周、每月等）里的传输次数；“高峰期流量”则是指在高峰时期的数据流量。

4. **数据存储**

数据存储是数据结构停留或保存的地方，也是数据流的来源和去向之一，它可以是手工文档或手工凭单，也可以是计算机文档。通常，数据存储描述={数据存储名，说明，编号，输入的数据流，输出的数据流，组成:{数据结构}，数据量，存取频度，存取方式}

其中，“存取频度”指每小时、每天或每周存取次数及每次存取的数据量等信息；“存取方式”指是批处理还是联机处理、是检索还是更新、是顺序检索还是随机检索等；另外，“输入的数据流”要指出其来源；“输出的数据流”要指出其去向。

5. **处理过程**

处理过程的具体处理逻辑一般用判定表或判定树来描述，数据字典中只需要描述处理过程的说明性信息即可。通常，处理过程描述={处理过程名，说明，输入:{数据流}，输出:{数据流}，处理:{简要说明}}

其中，“简要说明”主要说明该处理过程的功能及处理要求。功能是指该处理过程用来做什么（而不是怎么做），处理要求指处理频度要求，如单位时间里处理多少事务、多少数据量、响应时间要求等。这些处理要求是后面物理设计的输入及性能评价的标准。

# 三、概念结构设计

将需求分析得到的用户需求抽象为信息结构（即概念模型）的过程就是概念结构设计。描述概念模型的有力工具是E-R模型或UML模型等。

需要注意的是，由于E-R图的图形元素并没有标准化，不同的教材和不同的构建E-R图的工具软件都会有一些差异。

## （一）E-R模型

### 1. 定义概念

概念模型实际上是现实世界到机器世界的一个中间层次，是现实世界到机器世界的第一层抽象，信息世界主要涉及以下一些概念：

- 实体（entity），客观存在并可相互区别的事物称为实体，可以是具体的人事物或抽象的概念和联系。
- 属性（attribute），实体所具有的某一特性称为属性，一个实体可以由若干属性来刻画。
- 码（key），唯一标识实体的属性集称为码。
- 实体型（entity type），具有相同属性的实体必然具有共同的特征和性质，用实体名及其属性名集合来抽象和刻画同类实体，称为实体型。
- 实体集（entity set），同一类型实体的集合称为实体集。
- 联系（relationship），现实世界中事物内部和事物之间是有联系的，即实体内部的联系（通常值组成实体的各属性之间的联系），和实体之间的联系（通常指不同实体集之间的联系）。

### 2. 实体之间的联系

两个实体型之间的联系可以分为以下三种：

- 一对一联系（1:1），如果对于实体集A中的每一个实体，实体集B中至多有一个（也可以没有）实体与之联系，反之亦然，则称实体集A与实体集B具有一对一联系，记为1:1。
- 一对多联系（1:n），如果对于实体集A中的每一个实体，实体集B中有n个实体（n≥0）与之联系，反之，对于实体集B中的每一个实体，实体集A中至多只有一个实体与之联系，则称实体集A与实体集B有一对多联系，记为1:n。
- 多对多联系（m:n），如果对于实体集A中的每一个实体，实体集B中有n个实体（n≥0）与之联系，反之，对于实体集B中的每一个实体，实体集A中也有m个实体（m≥0）与之联系，则称实体集A与实体集B具有多对多联系，记为m:n。

![](数据库设计与应用开发.assets/两个实体型之间的三类联系.jpg)

一般地，两个以上的实体型之间也存在着一对一、一对多和多对多的联系。同一个实体集内的各实体之间也可以存在一对一、一对多和多对多的联系。

一般地，把参与联系的实体型的数目称为联系的度。两个实体型之间的联系度为2，也称为二元联系；三个实体型之间的联系度为3，称为三元联系；N个实体型之间的联系度为N，也称为N元联系。

### 3. E-R图

E-R图提供了表示实体型、属性和联系的方法：

- 实体型用矩形表示，矩形框内写明实体名。
- 属性用椭圆形表示，并用无向边将其与相应的实体型连接起来。
- 联系用菱形表示，菱形框内写明联系名，并用无向边分别与有关实体型连接起来，同时在无向边旁标上联系的类型（1:1、1:n或m:n）。需要注意的是，如果一个联系具有属性，则这些属性也要用无向边与该联系连接起来。

## （二）扩展的E-R模型

在基本E-R模型的基础上进行了某些方面的扩展，使其表达能力更强。

### 1. ISA联系

某些实体型是某个实体型的子类型，这种父类-子类联系称为ISA联系，表示“is a”的语义，它描述了对一个实体型中实体的一种分类方法。ISA联系一个重要的性质是子类继承了父类的所有属性，当然子类也可以有自己的属性。ISA联系用三角形来表示。

根据**分类属性**的值把父实体型中的实体分派到子实体型中。

**不相交约束**描述父类中的一个实体不能同时属于多个子类中的实体集，即一个父类中的实体最多属于一个子类实体集，用ISA联系三角形符号内加一个叉号“X”来表示。如果父类中的一个实体能同时属于多个子类中的实体集，则称为**可重叠约束**，子类符号中没有叉号表示是可重叠的。

完备性约束描述父类中的一个实体是否必须是某一个子类中的实体，如果是，则叫做**完全特化**（total specialization），否则叫做**部分特化**（partial specialization），完全特化用父类到子类的双线连接来表示，单线连接则表示部分特化。

### 2. 基数约束

参与联系的每个实体型用基数约束来说明实体型中的任何一个实体可以在联系中出现的最少次数和最多次数。约束用一个数对`min..max`表示，0≤min≤max（*代表无穷大）。

min=1的约束叫做强制参与约束，即被施加基数约束的实体型中的每个实体都要参与联系；min=0的约束叫做非强制参与约束，被施加基数约束的实体型中的实体可以出现在联系中，也可以不出现在联系中。

### 3. Part-of联系

即部分联系，它表明某个实体型是另外一个实体型的一部分，可分为两种情况，一种是整体实体如果被破坏，部分实体仍然可以独立存在，称为非独占的Part-of联系，可以通过基数约束来表达，因此在E-R图中用非强制参与联系表示非独占Part-of联系。

还有一种Part-of联系是独占联系，即整体实体如果被破坏，部分实体不能存在，在E-R图中用弱实体类型和识别联系来表示独占联系。如果一个实体型的存在必须依赖于其他实体型的存在，则这个实体型叫做**弱实体型**，否则叫做**强实体型**。

一般地讲，如果不能从一个实体型的属性中找出可以作为码的属性，则这个实体型是弱实体型。在E-R图中用双矩形表示弱实体型，用双菱形表示识别联系。

## （三）UML

表示E-R图的方法有若干种，使用统一建模语言UML是其中之一。UML中的类（class）大致对应E-R图中的实体，考虑到E-R模型和关系模型都不提供方法，因此这里用UML表示E-R图时省略了对象方法的说明。

UML表示实体和联系的方式与E-R图相对应，如实体型、码、联系、基数约束、子类等。

需要注意的是，如果应用的设计开发的全过程是使用UML规范，则一般采用UML对数据建模；如果应用设计开发不是使用UML，则建议数据库设计采用E-R模型来表示概念模型。总之，应保证在一个数据库应用系统的分析设计开发阶段所使用工具的一致性。

# 四、概念结构设计

这里介绍在设计E-R图的过程中如何确定实体与属性，以及在集成E-R图时如何解决冲突等关键技术。

## （一）实体与属性的划分原则

在数据字典中，数据结构、数据流和数据存储都是若干属性有意义的聚合，可以先从这些内容出发定义E-R图，然后再进行必要的调整。在调整中遵循的一条原则是，为了简化E-R图的处置，现实世界的事物能作为属性对待的尽量作为属性对待。可以给出作为属性对待的两条准则：

- 作为属性，不能再具有需要描述的性质，即属性必须是不可分的数据项，不能包含其他属性。
- 属性不能与其他实体具有联系，即E-R图中所表示的联系是实体之间的联系。

凡满足上述两条准则的事物，一般均可作为属性对待。

## （二）E-R图的集成

在开发一个大型信息系统时，最经常采用的策略是自顶向下地进行需求分析，然后再自底向上地设计概念结构。即首先设计各子系统的分E-R图，然后将它们集成起来，得到全局E-R图。

E-R图的集成一般需两步。合并，解决各分E-R图之间的冲突，将分E-R图合并起来生成初步E-R图。修改和重构，消除不必要的冗余，生成基本E-R图。

### 1. 合并E-R图

各个局部应用所面向的问题不同，且通常是由不同的设计人员进行局部视图设计，这就导致各个子系统的E-R图之间必定会存在许多不一致的地方，称之为冲突，各子系统的E-R图之间的冲突主要有三类。

- **属性冲突**主要包含以下两类冲突：
  - 属性域冲突，即属性值的类型、取值范围或取值集合不同。
  - 属性取值单位冲突。
- **命名冲突**主要包含以下两类冲突：
  - 同名异义，即不同意义的对象在不同的局部应用中具有相同的名字。
  - 异名同义（一义多名），即同一意义的对象在不同的局部应用中具有不同的名字。
- **结构冲突**主要包含以下三类冲突：
  - 同一对象在不同应用中具有不同的抽象，在有的局部应用中当做实体，而在另一局部中当做属性。
  - 同一实体在不同子系统的E-R图中所包含的属性个数和属性排列次序不完全相同。这是很常见的一类冲突，原因是不同的局部应用关心的是该实体的不同侧面。解决方法是使该实体的属性取各子系统的E-R图中属性的并集，再适当调整属性的次序。
  - 实体间的联系在不同的E-R图中为不同的类型。

### 2. 消除不必要的冗余

冗余数据是指可由基本数据导出的数据，冗余联系是指可由其他联系导出的联系。消除冗余主要采用分析方法，即以数据字典和数据流图为依据，根据数据字典中关于数据项之间逻辑关系的说明来消除冗余。

但并不是所有的冗余数据与冗余联系都必须加以消除，有时为了提高效率，不得不以冗余信息作为代价。因此在设计数据库概念结构时，哪些冗余信息必须消除，哪些冗余信息允许存在，需要根据用户的整体需求来确定。如果人为地保留了一些冗余数据，则应把数据字典中数据关联的说明作为完整性约束条件。

除分析方法外，还可以用规范化理论来消除冗余。在规范化理论中，函数依赖的概念提供了消除冗余联系的形式化工具。具体方法如下：

1. 确定分E-R图实体之间的数据依赖。实体之间一对一、一对多、多对多的联系可以用实体码之间的函数依赖来表示。
2. 求F的最小覆盖G，差集为D=F-G，逐一考察D中的函数依赖，确定是否是冗余的联系，若是就把它去掉。

由于规范化理论受到泛化关系假设的限制，应注意下面两个问题：

- 冗余的联系一定在D中，而D中的联系不一定是冗余的。
- 当实体之间存在多种联系时，要将实体之间的联系在形式上加以区分。

# 五、逻辑结构设计

逻辑结构设计要把基本E-R图转换为与选用数据库管理系统产品所支持的数据模型相符合的逻辑结构。目前的数据库应用系统都采用支持关系数据模型的关系数据库管理系统，所以这里只介绍E-R图向关系数据模型的转换原则与方法。

## （一）E-R图向关系模型的转换

如何将实体型和实体间的联系转换为关系模式，并确定这些关系模式的属性和码。转换的一般原则就是，一个实体型转换为一个关系模式，关系的属性就是实体的属性，关系的码就是实体的码。

对于实体型间的联系（二元关系）有以下不同的情况：

- 一个1:1联系可以转换为一个独立的关系模式，也可以与任意一端对应的关系模式合并。
  - 如果转换为一个独立的关系模式，则与该联系相连的各实体的码以及联系本身的属性均转换为关系的属性，每个实体的码均是该关系的候选码。
  - 如果与某一端实体对应的关系模式合并，则需要在该关系模式的属性中加入另一个关系模式的码和联系本身的属性。
- 一个1:n联系可以转换为一个独立的关系模式，也可以与n端对应的关系模式合并。
  - 如果转换为一个独立的关系模式，则与该联系相连的各实体的码以及联系本身的属性均转换为关系的属性，而关系的码为n端实体的码。
- 一个m:n联系转换为一个关系模式，与该联系相连的各实体的码以及联系本身的属性均转换为关系的属性，各实体的码组成关系的码或关系码的一部分。
- 三个或三个以上实体间的一个多元联系可以转换为一个关系模式。与该多元联系相连的各实体的码以及联系本身的属性均转换为关系的属性，各实体的码组成关系的码或关系码的一部分。
- 具有相同码的关系模式可合并。

## （二）数据模型的优化

数据库逻辑设计的结果不是唯一的。为进一步提高数据库应用系统的性能，还应该根据应用需要适当地修改、调整数据模型的结构，这就是数据模型的优化。优化通常以规范化理论为指导，方法为：

1. 确定数据依赖。按需求分析阶段所得到的语义，分别写出每个关系模式内部各属性之间的数据依赖以及不同关系模式属性之间的数据依赖。
2. 对于各个关系模式之间的数据依赖进行极小化处理，消除冗余的联系，具体方法参考上述。
3. 按照数据依赖的理论对关系模式逐一进行分析，考察是否存在部分函数依赖、传递函数依赖、多值依赖等，确定各关系模式分别属于第几范式。
4. 根据需求分析阶段得到的处理要求分析对于这样的应用环境这些模式是否合适，确定是否要对某些模式进行合并或分解。必须注意的是，并不是规范化程度越高的关系就越优。
   - 例如，当查询经常涉及两个或多个关系模式的属性时，系统经常进行连接运算。连接运算的代价是相当高的，可以说关系模型低效的主要原因就是由连接运算引起的。这时可以考虑将这几个关系合并为一个关系，因此在这种情况下，第二范式甚至第一范式也许是合适的。
   - 又如，非BCNF的关系模式虽然从理论上分析会存在不同程度的更新异常或冗余，但如果在实际应用中对此关系模式只是查询，并不执行更新操作，则不会产生实际影响。
   - 所以对于一个具体应用来说，到底规范化到什么程度需要权衡响应时间和潜在问题两者的利弊决定。
5. 对关系模式进行必要分解，提高数据操作效率和存储空间利用率。常用的两种分解方法是水平分解和垂直分解。
   - 水平分解是把（基本）关系的元组分为若干子集合，定义每个子集合为一个子关系，以提高系统的效率。根据八二原则，一个大关系中，经常被使用的数据只是关系的一部分，把经常使用的数据分解出来，形成一个子关系。如果关系上具有n个事务，而且多数事务存取的数据不相交，则可分解为少于或等于n个子关系，使每个事务存取的数据对应一个关系。
   - 垂直分解是把关系模式R的属性分解为若干子集合，形成若干子关系模式。垂直分解的原则是，将经常在一起使用的属性从中分解出来形成一个子关系模式。垂直分解可以提高某些事务的效率，但也可能使另一些事务不得不执行连接操作，从而降低了效率。因此是否进行垂直分解取决于分解后R上的所有事务的总效率是否得到了提高。垂直分解需要确保无损连接性和保持函数依赖，可参考《关系数据库理论》的分解算法。

## （三）设计用户子模式

将概念模型转换为全局逻辑模型后，还应该根据局部应用需求，结合具体关系数据库管理系统的特点（如视图概念）设计用户的外模式。

定义数据库全局模式主要是从系统的时间效率、空间效率、易维护等角度出发。由于用户外模式与模式是相对独立的，因此在定义用户外模式时可以注重考虑用户的习惯与方便。具体包括以下几方面：

- 使用更符合用户习惯的别名。用视图机制可以在设计用户视图时重新定义某些属性名，使其与用户习惯一致，以方便使用。
- 可以对不同级别的用户定义不同的视图，以保证系统的安全性。
- 简化用户对系统的使用。如果某些局部应用中经常要使用某些很复杂的查询，为方便用户，可以将这些复杂查询定义为视图，用户每次只需要对定义好的视图进行查询。

# 六、物理结构设计

数据库在物理设备上的存储结构与存取方法称为数裾库的物理结构，它依赖于选定的数据库管理系统。为一个给定的逻辑数据模型选取一个最适合应用要求的物理结构的过程，就是数据库的物理设计。

## （一）数据库物理设计的内容和方法

不同的数据库产品所提供的物理环境、存取方法和存储结构有很大差别，能供设计人员使用的设计变量、参数范围也很不相同，因此没有通用的物理设计方法可遵循，只能给出一般的设计内容和原则。

希望设计优化的物理数据库结构，使得在数据库上运行的各种事务响应时间小、存储空间利用率高、事务吞吐率大。为此，首先对要运行的事务进行详细分析，获得选择物理数据库设计所需要的参数；其次，要充分了解所用关系数据库管理系统的内部特征，特别是系统提供的存取方法和存储结构。

对于数据库查询事务，需要得到的信息有：查询的关系、查询条件所涉及的属性、连接条件所涉及的属性、查询的投影属性。

对于数据更新事务，需要得到的信息有：被更新的关系、每个关系上的更新操作条件所涉及的属性、修改操作要改变的属性值。

除此之外，还需要知道每个事务在各关系上运行的频率和性能要求。上述这些信息是确定关系的存取方法的依裾。

应注意的是，数据库上运行的事务会不断变化、增加或减少，以后需要根据上述设计信息的变化调整数据库的物理结构。

通常关系数据库物理设计的内容主要包括：为关系模式选择存取方法，设计关系、索引等数据库文件的物理存储结构。下面就介绍这些设计内容和方法。

## （二）关系模式存取方法选择

数据库系统是多用户共享的系统，对同一个关系要建立多条存取路径才能满足多用户的多种应用要求。

数据库管理系统一般提供多种存取方法，常用的存取方法为索引方法和聚簇（clustering）方法，其中B+树索引和hash索引是数据库中经典的存取方法，使用最普遍。

### 1. B+树索引存取方法的选择

所谓选择索引存取方法，实际上就是根据应用要求确定对关系的哪些属性列建立索引、哪些属性列建立组合索引、哪些索引要设计为唯一索引等。一般来说：

- 如果一个（或一组）属性经常在查询条件中出现，则考虑在这个（或这组）属性上建立索引（或组合索引）。

- 如果一个属性经常作为最大值和最小值等聚集函数的参数，则考虑在这个属性上建立索引。

- 如果一个（或一组）属性经常在连接操作的连接条件中出现，则考虑在这个（或这组）属性上建立索引。

关系上定义的索引数并不是越多越好，系统为维护索引要付出代价，查找索引也要付出代价。例如，若一个关系的更新频率很高，这个关系上定义的索引数不能太多。因为更新一个关系时，必须对这个关系上有关的索引做相应的修改。

### 2. hash索引存取方法的选择

选择hash存取方法的规则如下：如果一个关系的属性主要出现在等值连接条件中或主要出现在等值比较选择条件中，而且满足下列两个条件之一，则此关系可以选择hash存取方法。

- 一个关系的大小可预知，而且不变。

- 关系的大小动态改变，但数据库管理系统提供了动态hash存取方法。

### 3. 聚簇存取方法的选择

为了提高某个属性（或属性组）的查询速度，把这个或这些属性上具有相同值的元组集中存放在连续的物理块中，称为聚簇。该属性（或属性组）称为**聚簇码**（cluster key）。

聚簇功能可以大大提高按聚簇码进行查询的效率。聚簇功能不但适用于单个关系，也适用于经常进行连接操作的多个关系。即把多个连接关系的元组按连接属性值聚集存放，这就相当于把多个关系按“预连接”的形式存放，从而大大提高连接操作的效率。

一个数据库可以建立多个聚簇，一个关系只能加入一个聚簇。选择聚簇存取方法，即确定需要建立多少个聚簇，每个聚簇中包括哪些关系。

首先设计候选聚簇，一般来说：

- 对经常在一起进行连接操作的关系可以建立聚簇。
- 如果一个关系的一组属性经常出现在相等比较条件中，则该单个关系可建立聚簇。
- 如果一个关系的一个（或一组）属性上的值重复率很高，则此单个关系可建立聚簇。即对应每个聚簇码值的平均元组数不能太少，太少则聚簇的效果不明显。

然后检查候选聚簇中的关系，取消其中不必要的关系：

- 从聚簇中删除经常进行全表扫描的关系。
- 从聚簇中删除更新操作远多于连接操作的关系。
- 不同的聚簇中可能包含相同的关系，一个关系可以在某一个聚簇中，但不能同时加入多个聚簇。要从这多个聚簇方案（包括不建立聚簇）中选择一个较优的，即在这个聚簇上运行各种事务的总代价最小。

必须强调的是，聚簇只能提高某些应用的性能，而且建立与维护聚簇的开销是相当大的。对已有关系建立聚簇将导致关系中元组移动其物理存储位置，并使此关系上原来建立的所有索引无效，必须重建。当一个元组的聚簇码值改变时，该元组的存储位置也要做相应移动，聚簇码值要相对稳定，以减少修改聚簇码值所引起的维护开销。

因此，当通过聚簇码进行访问或连接是该关系的主要应用，与聚簇码无关的其他访问很少或者是次要的，这时可以使用聚簇。尤其当SQL语句中包含有与聚簇码有关的ORDER BY、GROUP BY、UNION、DISTINCT等子句或短语时，使用聚簇特别有利，可以省去对结果集的排序操作；否则很可能会适得其反。

## （三）确定数据库的存储结构

主要确定数据的存放位置和存储结构，包括确定关系、索引、聚簇、日志、备份等的存储安排和存储结构，确定系统配置等。

确定数据的存放位置和存储结构要综合考虑存取时间、存储空间利用率和维护代价三方面的因素。这三个方面常常是相互矛盾的，因此需要进行权衡，选择一个折中方案。

### 1. 确定数据的存放位置

为了提高系统性能，应该根据应用情况将数据的易变部分与稳定部分、经常存取部分和存取频率较低部分分开存放。

由于各个系统所能提供的对数据进行物理安排的手段、方法差异很大，因此设计人员应仔细了解给定的关系数据库管理系统提供的方法和参数，针对应用环境的要求对数据进行适当的物理安排。

### 2. 确定系统配置

关系数据库管理系统产品一般都提供了一些系统配置变量和存储分配参数，初始情况下，系统都为这些变量赋予了合理的默认值。但不一定适合每一种应用环境，在进行物理设计时需要重新对这些变量赋值，以改善系统的性能。

系统配置变量很多，例如，同时使用数据库的用户数，同时打开的数据库对象数，内存分配参数，缓冲区分配参数（使用的缓冲区长度、个数），存储分配参数，物理块的大小，物理块装填因子，时间片大小，数据库大小，锁的数目等。

这些参数值影响存取时间和存储空间的分配，在物理设计时就要根据应用环境确定这些参数值，以使系统性能最佳。在物理设计时对系统配置变量的调整只是初步的，在系统运行时还要根据系统实际运行情况做进一步的调整，以期切实改进系统性能。

## （四）评价物理结构

数据库物理设计过程中需要对时间效率、空间效率、维护代价和各种用户要求进行权衡，其结果可以产生多种方案。数据库设计人员必须对这些方案进行细致的评价，从中选择一个较优的方案作为数据库的物理结构。

评价物理数据库的方法完全依赖于所选用的关系数据库管理系统，主要是从定量估算各种方案的存储空间、存取时间和维护代价入手，对估算结果进行权衡、比较，选择出一个较优的、合理的物理结构。如果该结构不符合用户需求，则需要修改设计。

# 七、数据库的实施和维护

完成物理设计之后，设计人员就要用关系数据库管理系统提供的数据定义语言和其他实用程序将数据库逻辑设计和物理设计结果严格描述出来，成为关系数据库管理系统可以接受的源代码，再经过调试产生目标模式，然后就可以组织数据入库了，这就是数据库实施阶段。

## （一）数据的载入和应用程序的调试

数据库实施阶段包括两项重要的工作，一项是数据的载入，另一项是应用程序的编码和调试。

组织数据载入就要将各类源数据从各个局部应用中抽取出来，输入计算机，再分类转换，最后综合成符合新设计的数据库结构的形式，输入数据库。

这样的数据转换、组织入库的工作是相当费力、费时的，特别是原系统是手工数据处理系统时。可以且应该针对具体的应用环境设计一个数据录入子系统，由计算机来完成数据入库的任务。在源数据入库之前要采用多种方法对其进行检验，以防止不正确的数据入库，这部分的工作在整个数据输入子系统中是非常重要的。

现有的关系数据库管理系统一般都提供不同关系数据库管理系统之间数据转换的工具，若原来是数据库系统，就要充分利用新系统的数据转换工具。

数据库应用程序的设计应该与数据库设计同时进行，因此在组织数据入库的同时还要调试应用程序。

## （二）数据库的试运行

在原有系统的数据有一小部分已输入数据库后，就可以幵始对数据库系统进行联合调试了，这又称为数据库的试运行。

这一阶段要实际运行数据库应用程序，执行对数据库的各种操作，测试应用程序的功能是否满足设计要求。如果不满足，对应用程序部分则要修改、调整，直到达到设计要求为止。在数据库试运行时，还要测试系统的性能指标，分析其是否达到设计目标。

应分期分批地组织数据入库，先输入小批量数据做调试用，待试运行基本合格后再大批量输入数据，逐步增加数据量，逐步完成运行评价。

在数据库试运行阶段，由于系统还不稳定，硬、软件故障随时都可能发生；而系统的操作人员对新系统还不熟悉，误操作也不可避免，因此要做好数据库的转储和恢复工作。一旦故障发生，能使数据库尽快恢复，尽量减少对数据库的破坏。

## （三）数据库的运行和维护

数据库试运行合格后，数据库开发工作就基本完成，可以投入正式运行了。但是由于应用环境在不断变化，数据库运行过程中物理存储也章不断变化，对数据库设计进行评价、调整、修改等维护工作是一个长期的任务，也是设计工作的继续和提高。

在数据库运行阶段，对数据库经常性的维护工作主要是由数据库管理员完成的。数据库的维护工作主要包括以下几方面。

数据库的转储和恢复。这是系统正式运行后最重要的维护工作之一，数据库管理员要针对不同的应用要求制定不同的转储计划，以保证一旦发生故障能尽快将数据库恢复到某种一致的状态，并尽可能减少对数据库的破坏。

数据库的安全性、完整性控制。在数据库运行过程中，由于应用环境的变化，对安全性的要求也会发生变化，比如有的数据原来是机密的，现在则可以公开查询，而新加入的数据又可能是机密的。系统中用
户的密级也会改变。这些都需要数据库管理员根据实际情况修改原有的安全性控制。同样，数据库的完整性约束条件也会变化，也需要数据库管理员不断修正，以满足用户要求。

数据库性能的监督、分析和改造。在数据库运行过程中，监督系统运行，对监测数裾进行分析，找出改进系统性能的方法是数据库管理员的又一重要任务。有些关系数据库管理系统提供了监测系统性能参数的工具，数据库管理员应仔细分析这些数据，判断当前系统运行状况是否为最佳，应当做哪些改进。

数据库的重组织与重构造。数据库运行一段时间后，由于记录不断增、删、改，将会使数据库的物理存储情况变坏，降低数据的存取效率，使数据库性能下降，这时数据库管理员就要对数据库进行重组织或部分重组织（只对频繁增、删的表进行重组织）。关系数据库管理系统一般都提供数据重组织用的实用程序。在重组织的过程中，按原设计要求重新安排存储位置、回收垃圾、减少指针链等，提高系统性能。

数据库的重组织并不修改原设计的逻辑和物理结构，而数据库的重构造则不同，它是指部分修改数据库的模式和内模式。

由于数据库应用环境发生变化，增加了新的应用或新的实体，取消了某些应用，有的实体与实体间的联系也发生了变化等，使原有的数据库设计不能满足新的需求，需要调整数据库的模式和内模式。当然重构也是有限的，只能做部分修改，如果应用变化太大，重构也无济于事，说明此数据库应用系统的生命周期已经结束，应该设计新的数据库应用系统了。